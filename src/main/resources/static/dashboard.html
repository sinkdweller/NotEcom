<html>
<head>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
</head>
<body>

<h2>HTML Table</h2>

<table id="dashboard-table">
  <tr>
    <th>Device</th>
    <th>Temperature</th>
    <th>Soil Moisture</th>
    <th>Captured At</th>

  </tr>
</table>
<button onclick="populateTable()"></button>
</body>

<script>
    populateTable();

    
    const token = localStorage.getItem("token");
    if(!token){
        window.alert("you must log in first!!");
        window.location.href = "/login.html";
    }
    async function populateTable(){
        const data = await getData();

        if(!data || !Array.isArray(data)) return;
        const parent = document.getElementById("dashboard-table");
        data.forEach(element => {
            const row = document.createElement("tr");
            
            const device = document.createElement("td");
            const temperature = document.createElement("td");
            const soilMoisture = document.createElement("td");
            const capturedAt = document.createElement("td");

            device.innerText = element.deviceName;
            temperature.innerText = element.temperature;
            soilMoisture.innerText = element.moisture;
            capturedAt.innerText=element.capturedAt;

            row.appendChild(device);
            row.appendChild(temperature);
            row.appendChild(soilMoisture);
            row.appendChild(capturedAt);

            parent.appendChild(row);

        });
    }
    async function getData(){
        const response = await fetch("/api/readings", {
            method: "GET",
            headers:{"Authorization": `Bearer ${token}`}
        })
        const data = await response.json();
        console.log(data);
        return data.content;
    }
</script>
</html>
